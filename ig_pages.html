<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IG Pages Admin</title>

<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f2f2f2; }

  /* HEADER - Instagram color */
  header {
    background: #C13584;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  header img { height: 48px; }

  .table-wrapper { overflow-x:auto; padding:1rem; }

  table { width:100%; border-collapse:collapse; background:white; min-width:600px; }
  th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; }
  th { background:#e6e6e6; font-weight:bold; }
  td.brand-logo img { height:42px; max-width:120px; object-fit:contain; }

  input[type="number"] { width:90px; text-align:center; padding:0.3rem; }

  .diff { font-weight:bold; }
  .diff.positive { color:green; }
  .diff.negative { color:red; }
  .diff.zero { color:black; }

  .save-container { text-align:center; margin:1.5rem 0 2rem; }
  button { padding:0.6rem 1.4rem; background:#C13584; color:white; border:none; border-radius:6px; cursor:pointer; }
</style>
</head>

<body>

<header>
  <img src="logo.svg" alt="Company Logo">
</header>

<div class="table-wrapper">
  <table id="igTable">
    <thead>
      <tr>
        <th>Brand</th>
        <th>Old</th>
        <th>New</th>
        <th>Difference</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="save-container">
  <button id="saveBtn">SAVE</button>
</div>

<script>
/* ================================
   CONFIG
================================= */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyeB9IruJ8-cGzdvbDAQVxYyuAYttq1uFKpVFWUxhAFbt_p4PqZQoCmyyPUndXBlo_Ljw/exec"; // Replace with your Apps Script URL
const BRANDS = [
  "team_ridemax","apollo_tyres","cooper","arivo_tires","atlander",
  "michelin","bfgoodrich","patriot","monsta","linglong",
  "profender_x_ridemax","profender_motorcycle","hamer","arb_x_ome",
  "airpro","fuel_offroad","vlf_wheels","wheel_pros","work_wheels",
  "venom","wildland","icooh_brakes"
];

const tbody = document.querySelector("#igTable tbody");
let OLD_VALUES = {};

/* ================================
   LOAD OLD VALUES FROM SHEET
================================= */
function loadOldValues() {
  fetch(WEB_APP_URL)
    .then(res => res.json())
    .then(data => {
      OLD_VALUES = data;
      buildTable();
    })
    .catch(() => {
      alert("Offline mode: old values set to 0");
      buildTable();
    });
}

/* ================================
   BUILD TABLE
================================= */
function buildTable() {
  tbody.innerHTML = "";

  BRANDS.forEach(brand => {
    const oldVal = OLD_VALUES[brand] || 0;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="brand-logo">
        <img src="brands/${brand}.svg" alt="${brand}"
             onerror="this.src='brands/placeholder.svg'">
      </td>
      <td class="old-val">${oldVal}</td>
      <td><input type="number" class="new-val" min="0"></td>
      <td class="diff zero">0</td>
    `;

    const input = tr.querySelector(".new-val");
    const diffEl = tr.querySelector(".diff");

    input.addEventListener("input", () => {
      const diff = Number(input.value || 0) - oldVal;
      diffEl.textContent = diff;
      diffEl.className = "diff " + (diff > 0 ? "positive" : diff < 0 ? "negative" : "zero");
    });

    tbody.appendChild(tr);
  });
}

/* ================================
   SAVE TO GOOGLE SHEET
================================= */
function saveData() {
  const rows = [...tbody.querySelectorAll("tr")];

  const payload = rows.map(row => {
    const brand = row.querySelector("img").alt;
    const oldVal = Number(row.querySelector(".old-val").textContent);
    const newVal = Number(row.querySelector(".new-val").value || 0);
    return { brand, new: newVal, diff: newVal - oldVal };
  });

  fetch(WEB_APP_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if(data.status === "success") {
      alert("Saved successfully!");
      // Update table: new â†’ old
      rows.forEach(row => {
        const newVal = row.querySelector(".new-val").value || 0;
        row.querySelector(".old-val").textContent = newVal;
        row.querySelector(".new-val").value = "";
        row.querySelector(".diff").textContent = "0";
        row.querySelector(".diff").className = "diff zero";
      });
    } else {
      alert("Error saving: " + data.message);
    }
  })
  .catch(err => alert("Network error: " + err.message));
}

/* ================================
   EVENTS
================================= */
document.getElementById("saveBtn").addEventListener("click", saveData);

/* ================================
   INIT
================================= */
loadOldValues();

</script>

</body>
</html>

